<html>
  <head>
      <script src="https://cdn.jsdelivr.net/pyodide/v0.27.7/full/pyodide.js"></script>
  </head>
  <body>
    <div id="container"></div>
    <script type="text/javascript">
      window.MathJax = {
        loader: {
          load: ['output/svg', 'ui/menu']
        },
        tex: {
          packages: ['base', 'require']
        }
      };
    </script>
    <script type="text/javascript" id="MathJax-script" defer
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
  </script>
    <script type="text/javascript">
      async function main(){
        let pyodide = await loadPyodide();
        await pyodide.loadPackage("micropip");
        await pyodide.runPythonAsync(`
import micropip

micropip.install("manim-web")
`);
        await pyodide.runPythonAsync(`
from manim import *
from js import document


class ExampleScene(Scene):
    async def construct(self):
        document.getElementById("container").appendChild(self.canvas)
        self.canvas.style.width = "50vw"
        self.canvas.style.height = "auto"
        self.canvas.style.display = "block"
        circ = Circle(radius=1)
        sq = Square(color=BLUE, side_length=2)
        await self.play(Transform(sq, circ))
        plane = NumberPlane(faded_line_ratio=4)
        plane.add_coordinates()
        self.add(plane, sq)
        await self.play(Create(plane))
        eq = MathTex(r"x^2 + y^2 = 1")
        eq.to_edge(UP)
        await self.play(Write(eq))
        await self.render_frame()
        self.sq = sq
        self.eq = eq
    
    async def on_mouse_click(self, event):
        if not hasattr(self, 'sq') or not hasattr(self, 'eq'):
            return
        if event.button == 0:  # Left click
            # Compute canvas bbox
            bbox = self.canvas.getBoundingClientRect()
            bbox_width = bbox.width
            bbox_height = bbox.height
            offset_x = event.offsetX
            offset_y = event.offsetY
            x = offset_x / bbox_width * config.frame_width - config.frame_width / 2
            y = config.frame_height / 2 - offset_y / bbox_height * config.frame_height
            self.sq.move_to(x * RIGHT + y * UP)
            self.eq.become(MathTex(f"(x - {x:.2f})^2 + (y - {y:.2f})^2 = 1")).to_edge(UP)
            await self.render_frame()


scene = ExampleScene()
await scene.render()
`);
      }
      main();
    </script>
  </body>
</html>
